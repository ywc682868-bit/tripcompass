<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Trip Compass</title>
    <link rel="icon" type="image/png" href="icon.png">
    <link rel="apple-touch-icon" href="icon.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="default"> 
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
    /* --- 全域設定 --- */
    body { font-family: 'Inter', sans-serif; background-color: #f7f7f7; margin: 0; padding: 0; color: #5F6368; overflow-x: hidden; }
    .no-scrollbar::-webkit-scrollbar { display: none; }
    .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

    /* ✅ 修正：定義安全區域變數，並計算 Header 內容區高度 */
    :root {
        --safe-top: constant(safe-area-inset-top);
        --safe-top-var: env(safe-area-inset-top);
        /* 原有 Header 內容 (約 120px) + 狀態列高度（變數值） */
        --content-height: 120px; 
        --header-total-height: calc(var(--content-height) + var(--safe-top-var, 20px));
        --header-total-height-fallback: calc(var(--content-height) + var(--safe-top, 20px));
    }
    
    /* --- 容器與佈局 --- */
    #app-container { 
        max-width: 500px; 
        margin: 0 auto; 
        min-height: 100vh; 
        background-color: white; 
        /* ✅ 修正：padding-top 應為 Header 總高度 */
        padding-top: var(--header-total-height);
        padding-top: var(--header-total-height-fallback);
        padding-bottom: 140px; 
        position: relative; 
        box-shadow: 0 0 10px rgba(0,0,0,0.05); 
    }
    
    /* --- Header 固定區 --- */
    header { 
    position: fixed; 
    top: 0; 
    
    /* ✅ 修正置中：使用 left/right/margin 確保置中 */
    left: 0; 
    right: 0; 
    margin: 0 auto;
    
    width: 100%; 
    max-width: 500px; 
    background-color: #ffffff; /* 純白背景 (白色狀態列的關鍵) */
    z-index: 50; 
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);

    /* ✅ 修正浮動：強制 GPU 加速 */
    -webkit-transform: translate3d(0, 0, 0); 
    transform: translate3d(0, 0, 0); 
    -webkit-backface-visibility: hidden;
    backface-visibility: hidden;

    /* ✅ 修正：Header 總高度 */
    height: var(--header-total-height);
    height: var(--header-total-height-fallback);
    /* ======================================= */
}
    /* Header 內容區域（用於推送內容到狀態列下方） */
    #header-content-wrapper {
        /* ✅ 修正：將 Header 內容推入安全區域 */
        padding-top: var(--safe-top-var);
        padding-top: var(--safe-top); 
        padding-right: 0.75rem; /* px-3 */
        padding-left: 0.75rem; /* px-3 */
        padding-bottom: 0.25rem; /* pb-1 */
        
        /* 確保內容從 Header 頂部向下排列 */
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        
        /* 防止 Header 內容被裁剪 */
        overflow: visible;
        /* 重置 Tailwind 的 pt-3 class 確保不會重複填充 */
        padding-top: 0; /* 這裡的 padding-top 已經在 header 設置 */
    }

    #trip-select { background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%237E92A1' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M6 8l4 4 4-4'/%3e%3c/svg%3e"); background-position: right center; background-repeat: no-repeat; background-size: 1.25em 1.25em; -webkit-appearance: none; appearance: none; background-color: transparent; font-weight: 800; color: #4A4B4D; border: none; padding-right: 1.5rem; cursor: pointer; }
    #trip-select:focus { outline: none; }
    #header-day-date-container { padding-bottom: 0px; margin-top: 8px; margin-bottom: 1px; line-height: 1.2; }

    /* --- Footer (底部工具列) --- */
    #combined-bottom-bar { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); width: 95%; max-width: 480px; background-color: white; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15); z-index: 50; display: flex; flex-direction: column; padding: 0.4rem 0.75rem 0.2rem 0.75rem; border-radius: 24px; border: 1px solid #f0f0f0; }
    .prominent-integrated-btn { width: 30px; height: 30px; background-color: #7E92A1; border-radius: 50%; color: white; font-size: 18px; font-weight: 300; display: flex; align-items: center; justify-content: center; border: none; cursor: pointer; transition: transform 0.1s; }
    .prominent-integrated-btn:active { transform: scale(0.95); }
    #rate-display-label { font-size: 0.85rem; font-weight: bold; color: #7E92A1; line-height: 20px; }
    #bar-calc-result { font-size: 0.7rem; font-weight: bold; color: #7E92A1; }

    /* --- 行程卡片 (Trip Card) & 串連線 (Timeline) --- */
    /* 外層容器：負責定位與繪製串連線 */
    .trip-card { 
        width: 100%; 
        margin-bottom: 0.75rem; 
        position: relative; 
        min-height: 85px; 
        display: flex; 
        z-index: 0; /* 建立堆疊環境，確保子元素的 z-index -1 不會跑到 body 背景後面 */
    }

    /* 串連線 (Pseudo-element) - 修正：莫蘭迪咖啡色，並保持最下層，縮短長度 */
    .trip-card::before {
        content: '';
        position: absolute;
        left: 28px; /* 56px (w-14) 的一半 */
        top: -6px;        
        bottom: -6px;     
        width: 2px;
        background-color: #9C8B74; /* 莫蘭迪咖啡色 */
        z-index: -1; 
        transform: translateX(-50%);
    }
    /* 第一張卡片的線不要向上凸出 - 保持不變 */
    .trip-card:first-child::before { top: 42px; } /* 42px 是卡片高度的一半，確保線從中心點往下拉 */
    /* 最後一張卡片的線不要向下凸出 - 保持不變 */
    .trip-card:last-child::before { bottom: auto; height: 100%; }
    
    /* 視覺包裹層：不透明白底，遮住中間的線，只讓線在空隙露出 */
    .trip-card-visual-wrapper {
        position: relative;
        width: 100%;
        height: 100%;
        border-radius: 0.75rem; /* rounded-xl */
        overflow: hidden;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); /* shadow-lg */
        background-color: white; /* 必須是實色背景 */
        z-index: 10; /* 確保在線的上方 */
    }

    .swipe-item-container { position: relative; overflow: hidden; border-radius: 0.375rem; margin-bottom: 0.5rem; touch-action: pan-y; }
    
    .swipe-item-delete-bg { 
        position: absolute; top: 0; bottom: 0; right: 0; width: 140px; 
        display: flex; align-items: center; justify-content: flex-end; 
        z-index: 0; 
    }
    
    .swipe-item-content { 
        position: relative; z-index: 10; background-color: white; 
        transition: transform 0.2s ease-out; transform: translateX(0); 
        width: 100%; display: flex; align-items: stretch; 
    }
    
    .card-right-col { 
        display: flex; 
        flex-direction: column; 
        justify-content: flex-start; 
        align-items: flex-start; 
        gap: 8px; 
        width: 95px; min-width: 95px; max-width: 95px; flex: 0 0 95px;
        border-left: none; padding-left: 6px; padding-bottom: 0.25rem; padding-top: 12px; position: relative; 
    }
    .card-right-col::before {
        content: ''; position: absolute; left: 0; top: 8%; bottom: 8%; width: 1px; background-color: #C0C0C0;
    }

    .info-block-content { display: flex; flex-direction: column; justify-content: flex-start; align-items: flex-end; gap: 4px; width: 100%; }
    
    /* 按鈕靠左緊鄰，gap: 2px */
